import React, { createContext, useCallback, useContext, useEffect, useMemo, useState } from 'react';

export type Language = 'en' | 'vi';

type Dict = Record<string, string>;

const en: Dict = {
  'app.title': 'Indoor Autonomous Vehicle',
  'status.connected': '🟢 Connected',
  'status.connecting': '🟡 Connecting...',
  'status.disconnected': '🔴 Disconnected',

  // Pages
  'page.dashboard': 'Dashboard',
  'page.robot-control': 'Robot Control',
  'page.navigation': 'Navigation',
  'page.sensors': 'Sensors',
  'page.map-2d': '2D Map View',
  'page.map-3d': '3D Visualization',
  'page.map-editor': 'Map Editor',
  'page.map-management-status': 'Current Status',
  'page.map-management-maps': 'Map Management',
  'page.map-management-tasks': 'Task Management',
  'page.charts': 'Real-time Charts',
  'page.diagnostics': 'Diagnostics',
  'page.logs': 'System Logs',
  'page.parameters': 'Parameters',
  'page.nodes': 'Node Manager',
  'page.system-status': 'System Status',
  'page.system-guide': 'System Guide',

  // Dashboard
  'dashboard.title': 'Dashboard',
  'dashboard.subtitle': 'Quick overview and essential controls',
  'dashboard.battery': 'Battery',
  'dashboard.speed': 'Speed',
  'dashboard.position': 'Position',
  'dashboard.lidar': 'LiDAR',
  'dashboard.lidar_points': 'points detected',
  'dashboard.robot_status': 'Robot Status',
  'dashboard.current_position': 'Current Position',
  'dashboard.movement': 'Movement',
  'dashboard.speed_label': 'Speed',
  'dashboard.status': 'Status',
  'dashboard.moving': '🟢 Moving',
  'dashboard.stopped': '⏸️ Stopped',
  'dashboard.power': 'Power',
  'dashboard.nav_status': 'Navigation Status',
  'dashboard.current_goal': 'Current Goal',
  'dashboard.goal_status': 'Status',
  'dashboard.no_active_goal': 'No active goal',
  'dashboard.map_status': 'Map Status',
  'dashboard.map_loaded': '🟢 Map loaded',
  'dashboard.no_map': '🔴 No map',
  'dashboard.path_planning': 'Path Planning',
  'dashboard.ready_for_nav': 'Ready for navigation',
  'dashboard.system_health': 'System Health',
  'dashboard.connections': 'Connections',
  'dashboard.ros_nodes': 'ROS Nodes',
  'dashboard.active_nodes': 'Active',
  'dashboard.nodes': 'nodes',
  'dashboard.diagnostics': 'Diagnostics',
  'dashboard.all_ok': '🟢 All systems OK',
  'dashboard.no_diag': '🟡 No diagnostics',
  'dashboard.quick_actions': 'Quick Actions',
  'dashboard.emergency_stop': '🛑 Emergency Stop',
  'dashboard.go_home': '🏠 Go Home',
  'dashboard.start_nav': '🚀 Start Navigation',
  'dashboard.system_overview': 'System Overview',
  'dashboard.websocket_conn': 'WebSocket Connection',
  'dashboard.ros_nodes_count': 'ROS Nodes',
  'dashboard.lidar_sensor': 'LiDAR Sensor',
  'dashboard.odometry': 'Odometry',

  // Robot Control
  'rc.title': 'Robot Control',
  'rc.subtitle': 'Manual control and movement commands',
  'rc.mode.buttons': '🔘 Button Control',
  'rc.mode.basic': '🎮 Basic Joystick',
  'rc.mode.advanced': '🚀 Advanced Joystick',
  'rc.robot_status': 'Robot Status',
  'rc.position': 'Position',
  'rc.orientation': 'Orientation',
  'rc.velocity': 'Velocity',
  'rc.battery': 'Battery',
  'rc.level': 'Level',
  'rc.voltage': 'Voltage',
  'rc.sensors': 'Sensors',
  'rc.lidar_points': 'LiDAR Points',
  'rc.emergency': 'Emergency Controls',
  'rc.emergency_stop': '🛑 EMERGENCY STOP',
  'rc.stop_movement': '⏹️ Stop Movement',
  'rc.return_home': '🏠 Return Home',
  'rc.instructions': 'Control Instructions',
  'rc.warn.not_connected': 'Robot not connected',
  'rc.speed_settings': 'Speed Settings',
  'rc.linear_speed': 'Linear Speed',
  'rc.angular_speed': 'Angular Speed',
  'rc.movement_control': 'Movement Control',
  'rc.stop': 'Stop',
  'rc.home': 'Home',
  'rc.set_pose': 'Set Pose',
  'rc.current_speed': 'Current Speed',
  'rc.current_angular': 'Angular',
  'rc.snack.moving': '🎮 Moving',
  'rc.snack.stopped': '⏹️ Robot stopped',
  'rc.snack.returning_home': '🏠 Returning home...',
  'rc.manual_control': 'Manual Control:',
  'rc.tip.use_buttons': 'Use arrow buttons for movement',
  'rc.tip.adjust_speed': 'Adjust speed with sliders',
  'rc.tip.emergency_stop': 'Emergency stop always available',
  'rc.tip.realtime_feedback': 'Real-time feedback on robot status',
  'rc.safety_notes': 'Safety Notes:',
  'rc.tip.monitor': 'Always monitor robot surroundings',
  'rc.tip.use_emg': 'Use emergency stop if needed',
  'rc.tip.check_battery': 'Check battery level regularly',
  'rc.tip.clear_path': 'Ensure clear path before movement',

  // Map 2D
  'map2d.title': '2D Map View',
  'map2d.refresh': 'Force refresh map data',
  'map2d.save_map': 'Save the current map',
  'map2d.rc_wasd': '🎮 Robot Control (WASD)',
  'map2d.display_options': 'Display Options',
  'map2d.display_options_label': 'Display Options:',
  'map2d.show_lidar': 'Show LiDAR Scan',
  'map2d.show_path': 'Show Path',
  'map2d.show_goals': 'Show Goals',
  'map2d.auto_center': 'Auto Center on Robot',
  'map2d.quick_nav': 'Quick Navigation:',
  'map2d.go_home': '🏠 Go Home (0, 0)',
  'map2d.point_a': '📍 Point A (2, 2)',
  'map2d.point_b': '📍 Point B (-2, 2)',
  'map2d.point_c': '📍 Point C (0, -2)',
  'map2d.cancel_goal': '❌ Cancel Goal',
  'map2d.robot_status': 'Robot Status:',
  'map2d.mode.initial': 'Initial Pose',
  'map2d.mode.nav_goal': 'Nav Goal',
  // Map 2D - Controls
  'map2d.controls.title': '🎛️ Map Controls',
  'map2d.controls.map_source_title': '🗺️ Map Data Source',
  'map2d.controls.static_map': 'Static Map',
  'map2d.controls.dynamic_map': 'Dynamic Map',
  'map2d.controls.map_source.desc.static': 'Using pre-built static map',
  'map2d.controls.map_source.desc.dynamic': 'Using real-time SLAM map',
  'map2d.controls.position_mode_title': '📍 Robot Position Mode',
  'map2d.controls.receive_from_ros': 'Receive from ROS',
  'map2d.controls.send_to_ros': 'Send to ROS',
  'map2d.controls.position.desc.receive': 'Robot position updates from ROS',
  'map2d.controls.position.desc.send': 'Click map to set initial pose',
  'map2d.controls.position.alert': 'Click on the map to set robot initial position',
  'map2d.controls.running_mode_title': '🤖 Robot Running Mode',
  'map2d.controls.line_following': 'Line Following',
  'map2d.controls.slam_auto': 'SLAM Auto',
  'map2d.controls.running.desc.line_following': 'Robot follows predefined paths',
  'map2d.controls.running.desc.slam': 'Autonomous navigation with SLAM',
  'map2d.controls.multi_goal_title': '📌 Multi-Goal Mode (Cycle)',
  'map2d.controls.multiple_goals': 'Multiple Goals',
  'map2d.controls.single_goal': 'Single Goal',
  'map2d.controls.multi_goal.disabled': 'Disabled while setting initial pose',
  'map2d.controls.multi_goal.hint_multi': 'Pick multiple goals; drag to set direction',
  'map2d.controls.multi_goal.hint_single': 'Pick a single goal',
  'map2d.controls.selected': 'Selected',
  'map2d.controls.run': 'Run',
  'map2d.controls.clear': 'Clear',
  'map2d.wasd.press_to_move': 'Press WASD keys to move',
  // Map 2D - Legend
  'map2d.legend.title': '🗂️ Map Legend & Instructions',
  'map2d.legend.elements_title': '🎨 Map Elements:',
  'map2d.legend.green_circle': '🟢 Green Circle: Robot position',
  'map2d.legend.blue_line': '🔵 Blue Line: Robot direction',
  'map2d.legend.green_dots': '🟢 Green Dots: LiDAR scan points',
  'map2d.legend.brown_rects': '🟤 Brown Rectangles: Obstacles/walls',
  'map2d.legend.white_areas': '⚪ White Areas: Free space',
  'map2d.legend.gray_areas': '🔲 Gray Areas: Unknown space',
  'map2d.legend.interaction_title': '🖱️ Interaction:',
  'map2d.legend.interaction.click': 'Click: Set navigation goal',
  'map2d.legend.interaction.wasd': 'WASD Keys: Move robot directly',
  'map2d.legend.interaction.control_panel': 'Control Panel: Visual WASD in bottom-right',
  'map2d.legend.interaction.fullscreen': 'Fullscreen: Open in fullscreen mode',
  'map2d.legend.tips_title': '⚠️ Control Tips:',
  'map2d.legend.tips.wasd': 'WASD: W=Forward, S=Back, A=Left, D=Right',
  'map2d.legend.tips.stop': 'Stop Button: Click red stop or release keys',
  'map2d.legend.tips.navigation': 'Navigation: Click on free (white) areas',
  'map2d.legend.tips.manual': 'Manual Control: Use WASD for precise positioning',
  'map2d.legend.tips.mapping': 'Map Building: Move robot to explore areas',
  'map2d.legend.tips.monitor': 'Monitor robot progress and avoid obstacles',
  'map.instruction.initial': '📍 Click to set position, then click again to set direction',
  'map.instruction.goal': '📍 Click on map to set navigation goal',
  'map.info.fallback': '(Using fallback map - no real map data from ROS)',
  'map.info.resolution': 'Resolution',
  'map.info.size': 'Size',
  'map.info.robot': 'Robot',
  'map.header.interactive': '🗺️ Interactive Map',
  'map.fullscreen': 'Fullscreen',
  'map.dialog.title': '🗺️ Map View - Fullscreen',
  'map.viewer.no_data.title': 'No Map Data',
  'map.viewer.no_data.subtitle': 'Map will appear when available',
  'map.viewer.zoom_in': 'Zoom +',
  'map.viewer.zoom_out': 'Zoom -',
  'map.viewer.reset': 'Reset',
  // Sidebar
  'sidebar.header.title': 'Autonomous Vehicle',
  'sidebar.header.subtitle': 'Web Control Interface',
  'sidebar.cat.main': '🎮 Main Control',
  'sidebar.cat.monitoring': '📊 Monitoring',
  'sidebar.cat.tools': '🔧 Tools',
  'sidebar.cat.system': '⚙️ System',
  'sidebar.dashboard.desc': 'Overview & Quick Controls',
  'sidebar.robot_control.desc': 'Manual Movement & Commands',
  'sidebar.sensors.desc': 'LiDAR, Camera, IMU Data',
  'sidebar.map2d.desc': 'Traditional Map Visualization',
  'sidebar.map_management.desc': 'Map & Task Management',
  'sidebar.map_management_status.desc': 'Current robot status and control',
  'sidebar.map_management_maps.desc': 'View and edit available maps',
  'sidebar.map_management_tasks.desc': 'Create and manage robot tasks',
  'sidebar.map3d.desc': 'Virtual Gazebo Environment',
  'sidebar.map_editor.desc': 'Create & Edit 2D Maps',
  'sidebar.charts.desc': 'Live Data Visualization',
  'sidebar.diagnostics.desc': 'System Health & Performance',
  'sidebar.logs.desc': 'Real-time Log Monitoring',
  'sidebar.parameters.desc': 'Node Configuration',
  'sidebar.nodes.desc': 'Start/Stop ROS Nodes',
  'sidebar.system_status.desc': 'Hardware & Software Status',
  'sidebar.system_guide.desc': 'Installation & Setup Guide',

  // Sensors small
  'sensors.status': 'Sensor Status',
  'sensors.ultrasonic': 'Ultrasonic',
};

const vi: Dict = {
  'app.title': 'Hệ Thống Xe Tự Hành Trong Nhà',
  'status.connected': '🟢 Đã kết nối',
  'status.connecting': '🟡 Đang kết nối...',
  'status.disconnected': '🔴 Mất kết nối',

  // Pages
  'page.dashboard': 'Bảng điều khiển',
  'page.robot-control': 'Điều khiển Robot',
  'page.navigation': 'Dẫn đường',
  'page.sensors': 'Cảm biến',
  'page.map-2d': 'Bản đồ 2D',
  'page.map-3d': 'Hiển thị 3D',
  'page.map-editor': 'Trình sửa bản đồ',
  'page.map-management-status': 'Quản lý hiện trạng',
  'page.map-management-maps': 'Quản lý maps',
  'page.map-management-tasks': 'Quản lý nhiệm vụ',
  'page.charts': 'Biểu đồ thời gian thực',
  'page.diagnostics': 'Chẩn đoán',
  'page.logs': 'Nhật ký hệ thống',
  'page.parameters': 'Tham số',
  'page.nodes': 'Quản lý Node',
  'page.system-status': 'Trạng thái hệ thống',
  'page.system-guide': 'Hướng dẫn hệ thống',

  // Dashboard
  'dashboard.title': 'Bảng điều khiển',
  'dashboard.subtitle': 'Tổng quan nhanh và điều khiển chính',
  'dashboard.battery': 'Pin',
  'dashboard.speed': 'Tốc độ',
  'dashboard.position': 'Vị trí',
  'dashboard.lidar': 'LiDAR',
  'dashboard.lidar_points': 'điểm phát hiện',
  'dashboard.robot_status': 'Trạng thái Robot',
  'dashboard.current_position': 'Vị trí hiện tại',
  'dashboard.movement': 'Di chuyển',
  'dashboard.speed_label': 'Tốc độ',
  'dashboard.status': 'Trạng thái',
  'dashboard.moving': '🟢 Đang di chuyển',
  'dashboard.stopped': '⏸️ Đang dừng',
  'dashboard.power': 'Nguồn',
  'dashboard.nav_status': 'Trạng thái dẫn đường',
  'dashboard.current_goal': 'Mục tiêu hiện tại',
  'dashboard.goal_status': 'Trạng thái',
  'dashboard.no_active_goal': 'Không có mục tiêu',
  'dashboard.map_status': 'Trạng thái bản đồ',
  'dashboard.map_loaded': '🟢 Đã tải bản đồ',
  'dashboard.no_map': '🔴 Chưa có bản đồ',
  'dashboard.path_planning': 'Lập kế hoạch đường đi',
  'dashboard.ready_for_nav': 'Sẵn sàng dẫn đường',
  'dashboard.system_health': 'Sức khỏe hệ thống',
  'dashboard.connections': 'Kết nối',
  'dashboard.ros_nodes': 'ROS Nodes',
  'dashboard.active_nodes': 'Đang hoạt động',
  'dashboard.nodes': 'node',
  'dashboard.diagnostics': 'Chẩn đoán',
  'dashboard.all_ok': '🟢 Hệ thống ổn định',
  'dashboard.no_diag': '🟡 Chưa có chẩn đoán',
  'dashboard.quick_actions': 'Tác vụ nhanh',
  'dashboard.emergency_stop': '🛑 Dừng khẩn cấp',
  'dashboard.go_home': '🏠 Về Home',
  'dashboard.start_nav': '🚀 Bắt đầu dẫn đường',
  'dashboard.system_overview': 'Tổng quan hệ thống',
  'dashboard.websocket_conn': 'Kết nối WebSocket',
  'dashboard.ros_nodes_count': 'ROS Nodes',
  'dashboard.lidar_sensor': 'Cảm biến LiDAR',
  'dashboard.odometry': 'Odometry',

  // Robot Control
  'rc.title': 'Điều khiển Robot',
  'rc.subtitle': 'Điều khiển thủ công và lệnh di chuyển',
  'rc.mode.buttons': '🔘 Nút bấm',
  'rc.mode.basic': '🎮 Joystick cơ bản',
  'rc.mode.advanced': '🚀 Joystick nâng cao',
  'rc.robot_status': 'Trạng thái Robot',
  'rc.position': 'Vị trí',
  'rc.orientation': 'Hướng',
  'rc.velocity': 'Vận tốc',
  'rc.battery': 'Pin',
  'rc.level': 'Mức',
  'rc.voltage': 'Điện áp',
  'rc.sensors': 'Cảm biến',
  'rc.lidar_points': 'Số điểm LiDAR',
  'rc.emergency': 'Điều khiển khẩn cấp',
  'rc.emergency_stop': '🛑 DỪNG KHẨN CẤP',
  'rc.stop_movement': '⏹️ Dừng di chuyển',
  'rc.return_home': '🏠 Về Home',
  'rc.instructions': 'Hướng dẫn điều khiển',
  'rc.warn.not_connected': 'Robot chưa kết nối',
  'rc.speed_settings': 'Thiết lập tốc độ',
  'rc.linear_speed': 'Tốc độ thẳng',
  'rc.angular_speed': 'Tốc độ góc',
  'rc.movement_control': 'Điều khiển di chuyển',
  'rc.stop': 'Dừng',
  'rc.home': 'Home',
  'rc.set_pose': 'Đặt Pose',
  'rc.current_speed': 'Tốc độ hiện tại',
  'rc.current_angular': 'Góc quay',
  'rc.snack.moving': '🎮 Đang di chuyển',
  'rc.snack.stopped': '⏹️ Đã dừng robot',
  'rc.snack.returning_home': '🏠 Đang về Home...',
  'rc.manual_control': 'Điều khiển thủ công:',
  'rc.tip.use_buttons': 'Dùng các nút mũi tên để di chuyển',
  'rc.tip.adjust_speed': 'Điều chỉnh tốc độ bằng thanh trượt',
  'rc.tip.emergency_stop': 'Luôn có nút dừng khẩn cấp',
  'rc.tip.realtime_feedback': 'Phản hồi trạng thái theo thời gian thực',
  'rc.safety_notes': 'Lưu ý an toàn:',
  'rc.tip.monitor': 'Luôn quan sát xung quanh robot',
  'rc.tip.use_emg': 'Dùng dừng khẩn cấp khi cần',
  'rc.tip.check_battery': 'Kiểm tra pin thường xuyên',
  'rc.tip.clear_path': 'Đảm bảo lộ trình thông thoáng trước khi đi',

  // Map 2D
  'map2d.title': 'Bản đồ 2D',
  'map2d.refresh': 'Làm mới dữ liệu bản đồ',
  'map2d.save_map': 'Lưu bản đồ hiện tại',
  'map2d.rc_wasd': '🎮 Điều khiển Robot (WASD)',
  'map2d.display_options': 'Tùy chọn hiển thị',
  'map2d.display_options_label': 'Tùy chọn hiển thị:',
  'map2d.show_lidar': 'Hiển thị LiDAR',
  'map2d.show_path': 'Hiển thị đường đi',
  'map2d.show_goals': 'Hiển thị mục tiêu',
  'map2d.auto_center': 'Tự căn giữa theo robot',
  'map2d.quick_nav': 'Điều hướng nhanh:',
  'map2d.go_home': '🏠 Về Home (0, 0)',
  'map2d.point_a': '📍 Điểm A (2, 2)',
  'map2d.point_b': '📍 Điểm B (-2, 2)',
  'map2d.point_c': '📍 Điểm C (0, -2)',
  'map2d.cancel_goal': '❌ Hủy mục tiêu',
  'map2d.robot_status': 'Trạng thái Robot:',
  'map2d.mode.initial': 'Đặt vị trí ban đầu',
  'map2d.mode.nav_goal': 'Mục tiêu dẫn đường',
  // Map 2D - Controls
  'map2d.controls.title': '🎛️ Điều khiển bản đồ',
  'map2d.controls.map_source_title': '🗺️ Nguồn dữ liệu bản đồ',
  'map2d.controls.static_map': 'Bản đồ tĩnh',
  'map2d.controls.dynamic_map': 'Bản đồ động',
  'map2d.controls.map_source.desc.static': 'Sử dụng bản đồ tĩnh có sẵn',
  'map2d.controls.map_source.desc.dynamic': 'Sử dụng bản đồ SLAM theo thời gian thực',
  'map2d.controls.position_mode_title': '📍 Chế độ vị trí Robot',
  'map2d.controls.receive_from_ros': 'Nhận từ ROS',
  'map2d.controls.send_to_ros': 'Gửi lên ROS',
  'map2d.controls.position.desc.receive': 'Cập nhật vị trí từ ROS',
  'map2d.controls.position.desc.send': 'Bấm lên bản đồ để đặt vị trí ban đầu',
  'map2d.controls.position.alert': 'Bấm lên bản đồ để đặt vị trí ban đầu của robot',
  'map2d.controls.running_mode_title': '🤖 Chế độ chạy của Robot',
  'map2d.controls.line_following': 'Đi theo line',
  'map2d.controls.slam_auto': 'SLAM tự động',
  'map2d.controls.running.desc.line_following': 'Robot đi theo tuyến định sẵn',
  'map2d.controls.running.desc.slam': 'Tự hành với SLAM',
  'map2d.controls.multi_goal_title': '📌 Chế độ đa mục tiêu',
  'map2d.controls.multiple_goals': 'Nhiều mục tiêu',
  'map2d.controls.single_goal': 'Một mục tiêu',
  'map2d.controls.multi_goal.disabled': 'Bị vô hiệu khi đang đặt vị trí ban đầu',
  'map2d.controls.multi_goal.hint_multi': 'Chọn nhiều mục tiêu; kéo để đặt hướng',
  'map2d.controls.multi_goal.hint_single': 'Chọn một mục tiêu',
  'map2d.controls.selected': 'Đã chọn',
  'map2d.controls.run': 'Chạy',
  'map2d.controls.clear': 'Xóa',
  'map2d.wasd.press_to_move': 'Nhấn phím WASD để di chuyển',
  // Map 2D - Legend
  'map2d.legend.title': '🗂️ Chú giải & Hướng dẫn',
  'map2d.legend.elements_title': '🎨 Các thành phần bản đồ:',
  'map2d.legend.green_circle': '🟢 Vòng tròn xanh lá: Vị trí robot',
  'map2d.legend.blue_line': '🔵 Đường xanh dương: Hướng robot',
  'map2d.legend.green_dots': '🟢 Các chấm xanh lá: Điểm quét LiDAR',
  'map2d.legend.brown_rects': '🟤 Hình chữ nhật nâu: Vật cản/tường',
  'map2d.legend.white_areas': '⚪ Vùng trắng: Không gian trống',
  'map2d.legend.gray_areas': '🔲 Vùng xám: Không xác định',
  'map2d.legend.interaction_title': '🖱️ Tương tác:',
  'map2d.legend.interaction.click': 'Click: Đặt mục tiêu dẫn đường',
  'map2d.legend.interaction.wasd': 'Phím WASD: Di chuyển robot trực tiếp',
  'map2d.legend.interaction.control_panel': 'Bảng điều khiển: WASD trực quan ở góc dưới phải',
  'map2d.legend.interaction.fullscreen': 'Toàn màn hình: Mở chế độ toàn màn hình',
  'map2d.legend.tips_title': '⚠️ Mẹo điều khiển:',
  'map2d.legend.tips.wasd': 'WASD: W=Tiến, S=Lùi, A=Trái, D=Phải',
  'map2d.legend.tips.stop': 'Nút dừng: Bấm nút đỏ hoặc thả phím',
  'map2d.legend.tips.navigation': 'Dẫn đường: Bấm vào vùng trống (màu trắng)',
  'map2d.legend.tips.manual': 'Điều khiển tay: Dùng WASD để chỉnh chính xác',
  'map2d.legend.tips.mapping': 'Xây dựng bản đồ: Di chuyển robot để khám phá khu vực',
  'map2d.legend.tips.monitor': 'Theo dõi tiến trình và tránh vật cản',
  'map.instruction.initial': '📍 Bấm để chọn vị trí, bấm lần nữa để chọn hướng',
  'map.instruction.goal': '📍 Bấm lên bản đồ để đặt mục tiêu',
  'map.info.fallback': '(Đang dùng bản đồ tạm — chưa có dữ liệu từ ROS)',
  'map.info.resolution': 'Độ phân giải',
  'map.info.size': 'Kích thước',
  'map.info.robot': 'Robot',
  'map.header.interactive': '🗺️ Bản đồ tương tác',
  'map.fullscreen': 'Toàn màn hình',
  'map.dialog.title': '🗺️ Bản đồ - Toàn màn hình',
  'map.viewer.no_data.title': 'Chưa có dữ liệu bản đồ',
  'map.viewer.no_data.subtitle': 'Bản đồ sẽ hiển thị khi sẵn sàng',
  'map.viewer.zoom_in': 'Phóng +',
  'map.viewer.zoom_out': 'Thu -',
  'map.viewer.reset': 'Đặt lại',
  // Sidebar
  'sidebar.header.title': 'Xe tự hành',
  'sidebar.header.subtitle': 'Giao diện điều khiển web',
  'sidebar.cat.main': '🎮 Điều khiển chính',
  'sidebar.cat.monitoring': '📊 Giám sát',
  'sidebar.cat.tools': '🔧 Công cụ',
  'sidebar.cat.system': '⚙️ Hệ thống',
  'sidebar.dashboard.desc': 'Tổng quan & điều khiển nhanh',
  'sidebar.robot_control.desc': 'Điều khiển thủ công & lệnh',
  'sidebar.sensors.desc': 'Dữ liệu LiDAR, Camera, IMU',
  'sidebar.map2d.desc': 'Hiển thị bản đồ truyền thống',
  'sidebar.map_management.desc': 'Quản lý bản đồ & nhiệm vụ',
  'sidebar.map_management_status.desc': 'Trạng thái và điều khiển robot',
  'sidebar.map_management_maps.desc': 'Xem và chỉnh sửa bản đồ có sẵn',
  'sidebar.map_management_tasks.desc': 'Tạo và quản lý nhiệm vụ robot',
  'sidebar.map3d.desc': 'Môi trường ảo (giống Gazebo)',
  'sidebar.map_editor.desc': 'Tạo & chỉnh sửa bản đồ 2D',
  'sidebar.charts.desc': 'Biểu đồ dữ liệu trực tiếp',
  'sidebar.diagnostics.desc': 'Sức khỏe & hiệu năng hệ thống',
  'sidebar.logs.desc': 'Theo dõi log thời gian thực',
  'sidebar.parameters.desc': 'Cấu hình node',
  'sidebar.nodes.desc': 'Khởi động/dừng các node ROS',
  'sidebar.system_status.desc': 'Trạng thái phần cứng & phần mềm',
  'sidebar.system_guide.desc': 'Hướng dẫn cài đặt & thiết lập',

  // Sensors small
  'sensors.status': 'Trạng thái cảm biến',
  'sensors.ultrasonic': 'Siêu âm',
};

const DICTS: Record<Language, Dict> = { en, vi };

interface I18nContextValue {
  lang: Language;
  setLang: (l: Language) => void;
  t: (key: string, fallback?: string) => string;
}

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

const STORAGE_KEY = 'app.lang';

export const I18nProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [lang, setLangState] = useState<Language>(() => {
    const saved = (localStorage.getItem(STORAGE_KEY) || '').toLowerCase();
    return saved === 'vi' || saved === 'en' ? (saved as Language) : 'vi';
  });

  useEffect(() => {
    try { localStorage.setItem(STORAGE_KEY, lang); } catch {}
  }, [lang]);

  const setLang = useCallback((l: Language) => setLangState(l), []);

  const t = useCallback((key: string, fallback?: string) => {
    const dict = DICTS[lang] || {};
    return dict[key] ?? fallback ?? DICTS.en[key] ?? key;
  }, [lang]);

  const value = useMemo(() => ({ lang, setLang, t }), [lang, setLang, t]);

  return (
    <I18nContext.Provider value={value}>
      {children}
    </I18nContext.Provider>
  );
};

export const useI18n = () => {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
};
